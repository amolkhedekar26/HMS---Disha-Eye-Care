{% extends "base/receptionist/base.html" %}
{% load static %} 
{% load widget_tweaks %}

 {% block head %}
 <title>Next Working Days Schedule</title>
 <style>
   .radio-day {
        /* margin:8px; */
        width: fit-content;
        /* height: 40px; */
        position: relative;
        
      }

      .radio-day label,
      .radio-day input {
        display: block;
        border: 1px solid #ccc;
        /* padding:0 1em 1em 1em !important; */
        /* position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0; */
      }

      .radio-day input[type="radio"] {
        opacity: 0.011;
        z-index: 100;
      }

      .radio-day input[type="radio"]:checked + label {
        background: #4E944F;
        color: white;
        border-radius: 4px;
        /* padding:1em 1em 1em 1em; */
        font-weight: bold;
      }
      .radio-day input[type="radio"]:checked + label p{
        font-weight: bold;
      }
      /* .radio-day input[type="radio"]:checked + label::after {
        display: inline-block;
        content: "üëç";
        font-weight: bold;
        font-size: 1.2rem;
        padding: 0.3rem 0.5rem;
        border-radius: 4px;
        width: auto;
        color: green;
        background-color: rgb(255 255 255);
      } */

      .radio-day label {
        cursor: pointer;
        z-index: 90;
        /* line-height: 1.8em; */
        padding: 0.1em 1em;
        width: fit-content;
        /* border: 1px solid #ccc; */
      }
      .radio-day label p{
        /* font-weight: bold; */
        margin-top: 1rem;
        margin-bottom: 1rem;
      }
      .daily-slots-container{
        /* margin-top: 1rem; */
        max-width: min(90%,90%);
        margin: 0 auto;
      }
      .table{
        margin-top: 2rem;
      }
      th,td{
        padding: 1rem !important;
        text-align: center;
        vertical-align: middle;
  
      }
      /* .bx{
        font-size: 1.2rem;
      } */
      .pagination{
          display: flex;
          flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }
      .pagination li{
        display: inline-block;
        margin: 0.5rem;
        padding:0.5rem 1rem;
        border-radius: 4px;
        border: 1px solid #ccc;
      }
      .pagination li:hover{
        background-color: #ccc;
      }
      .pagination .active{
        background-color: #4E944F;
        color: white;
      }
      .list-container{
        display: flex;
        justify-content: space-between;
      }

      .radio-doctor {
        /* margin:8px; */
        width: fit-content;
        /* height: 40px; */
        position: relative;
        
      }

      .radio-doctor label,
      .radio-doctor input {
        display: block;
        border: 1px solid #ccc;
        /* padding:0 1em 1em 1em !important; */
        /* position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0; */
      }

      .radio-doctor input[type="checkbox"] {
        opacity: 0.011;
        z-index: 100;
      }

      .radio-doctor input[type="checkbox"]:checked + label {
        background: #4E944F;
        color: white;
        border-radius: 4px;
        /* padding:1em 1em 1em 1em; */
        font-weight: bold;
      }
      .radio-doctor input[type="checkbox"]:checked + label p{
        font-weight: bold;
      }
      /* .radio-doctor input[type="radio"]:checked + label::after {
        display: inline-block;
        content: "üëç";
        font-weight: bold;
        font-size: 1.2rem;
        padding: 0.3rem 0.5rem;
        border-radius: 4px;
        width: auto;
        color: green;
        background-color: rgb(255 255 255);
      } */

      .radio-doctor label {
        cursor: pointer;
        z-index: 90;
        /* line-height: 1.8em; */
        padding: 0.1em 1em;
        width: fit-content;
        /* border: 1px solid #ccc; */
      }
      .radio-doctor label p{
        /* font-weight: bold; */
        margin-top: 1rem;
        margin-bottom: 1rem;
      }

      .radio-doctor label p{
        /* font-weight: bold; */
        margin-top: 2rem;
      }
      .radio-doctor label h5{
        font-weight: bold;
        font-size: 1.2rem;
      }
      .radio-doctor-profile-image{
        /* width: 50px;
        height: 40px;
        border-radius: 50%; */
        /* margin-right: 8px; */
        width: 150px;
    border-radius: 0.5rem;
    margin-top: 1rem;
      }
      .list-container .btn-primary{
        height: max-content;
      }
      .list-container form{
        flex-basis: 60%;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }
      .daily-booking-slot-not-available{
        background-color: #ffc10768;
        padding: 0.5em;
        border-radius: 4px;
      }
        /* .appointment-confirmed{
            background-color: #2195f35e;
            color: whitesmoke;
            padding: 0.5em;
            border-radius: 8px;
        } */
        .daily-booking-slot-booked{
            background-color: #FF6363;
            color: whitesmoke;
            padding: 0.5em;
            border-radius: 4px;
        }
        .daily-booking-slot-available{
            background-color: #019267;
            /* color: black; */
            padding: 0.5em;
            border-radius: 4px;
        }
        .radio-next-working-days {
        /* margin:8px; */
        width: fit-content;
        /* height: 40px; */
        position: relative;
        
      }

      .radio-next-working-days label,
      .radio-next-working-days input {
        display: block;
        border: 1px solid #ccc;
        /* padding:0 1em 1em 1em !important; */
        /* position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0; */
      }

      .radio-next-working-days input[type="checkbox"] {
        opacity: 0.011;
        z-index: 100;
      }

      .radio-next-working-days input[type="checkbox"]:checked + label {
        background: #4E944F;
        color: white;
        border-radius: 4px;
        /* padding:1em 1em 1em 1em; */
        font-weight: bold;
      }
      .radio-next-working-days input[type="checkbox"]:checked + label p{
        font-weight: bold;
      }
      /* .radio-next-working-days input[type="radio"]:checked + label::after {
        display: inline-block;
        content: "üëç";
        font-weight: bold;
        font-size: 1.2rem;
        padding: 0.3rem 0.5rem;
        border-radius: 4px;
        width: auto;
        color: green;
        background-color: rgb(255 255 255);
      } */

      .radio-next-working-days label {
        cursor: pointer;
        z-index: 90;
        /* line-height: 1.8em; */
        padding: 0.1em 1em;
        width: fit-content;
        /* border: 1px solid #ccc; */
      }
      .radio-next-working-days label p{
        /* font-weight: bold; */
        margin-top: 1rem;
        margin-bottom: 1rem;
      }
 </style>

 {% endblock %}

 {% block sidebar %}
   {% with page_title="Schedule of next Working Days" %}
      <p class="hide">{{ block.super }}</p>
    {% endwith %}
 {% endblock %}
 
 {% block content %}
 <div class="daily-slots-container">
  {% if messages %}
  {% for message in messages %}
      {% if message.tags == 'success'%}
          <!-- <script>Toastify({
              text: "{{ message }}",
              className: "info",
              style: {
                background: "linear-gradient(to right, #00b09b, #96c93d)",
              }
            }).showToast();</script> -->
            <div class="alert alert-success" role="alert">
              {{ message }}
              <script>
                 
                 setTimeout(function(){    
                  document.querySelector('.alert').style.opacity = 0; 
                  document.querySelector('.alert').style.display = 'none';
                 }, 3000);
              </script>
            </div>
      {% endif %}
  {% endfor %}
{% endif %}

 <form id="generate-daily-schedule-form" method="post">
     {% csrf_token %}
  <!-- <div class="mb-3">
    <label for="input-day" class="form-label">Select Day</label>
    <div class="row">
      {% for choice in get_time_slots_form.date.field.choices %}
    <div class="radio-day">
        <input
        type="radio"
        id="id_radio_time_slot_{{ forloop.counter }}"
        name="days"
        value="{{ choice.0 }}"
        required
        {% if choice.0 == get_time_slots_form.days.field.initial %}
          checked
        {% endif %}
        />
        <label class="btn btn-default" for="id_radio_time_slot_{{ forloop.counter }}">
            <p>
                {{ choice.1 }}
            </p>
        </label>
        </div>
  {% endfor %}
  </div>
  </div> -->
  <!-- <div class="col-md-4 mb-3">
    <label for="input-day" class="form-label">Select next working days</label>
  {% render_field daily_slot_schedule_form.date class="form-control mt-3"  %}
  </div> -->
  <div class="col-md-12 mb-3">
    <label for="input-next-working-days-status" class="form-label">Select next working days</label>
    <div class="row">
      {% for choice in generate_daily_slot_schedule_form.next_working_days.field.choices %}
    <div class="radio-next-working-days">
        <input
        type="checkbox"
        id="id_radio_next_working_days_{{ forloop.counter }}"
        name="next_working_days"
        value="{{ choice.0 }}"
        
        />
        <label class="btn btn-default" for="id_radio_next_working_days_{{ forloop.counter }}">
            <p>
                {{ choice.1 |date:'l' }}
            </p>
            <h5>
                {{ choice.1 |date:'d M' }}
            </h5>
        </label>
        </div>
  {% endfor %}
  </div>
  </div>
  <div class="mb-3">
    <label for="input-doctor" class="form-label">Select Doctor</label>
    <div class="row">
      {% for choice in generate_daily_slot_schedule_form.doctors.field.choices %}
    <div class="radio-doctor">
        <input
        type="checkbox"
        id="id_radio_doctor_{{ forloop.counter }}"
        name="doctors"
        value="{{ choice.0 }}"
        {% if choice.0 == generate_daily_slot_schedule_form.doctors.field.initial %}
          checked
        {% endif %}
        />
        <label class="btn btn-default" for="id_radio_doctor_{{ forloop.counter }}">
          {% for d in generate_daily_slot_schedule_form.doctors.field.queryset.all %}
            {% if d.id == choice.0 %}
            <img class="radio-doctor-profile-image" src="{{ d.profile_image.url }}" alt="" width="50"> 
            
            <!-- <h5>
                {{ choice.1 }}
            </h5> -->
            <p>
                {{ choice.1 }}
            </p>
            {% endif %}
          {% endfor %}
        </label>
        </div>
  {% endfor %}
  </div>
  </div>
  
  <div class="">
    <input type="submit" class="btn btn-primary" style="width: fit-content;" value="Generate Schedule"/>
     
  </div>
</form>
{% if generated_daily_schedule %}
<hr>
<div class="list-container">
  <div>
    
    <!-- {% if selected_date %}
    <p> Date => <strong>{{ selected_date }}</strong></p>
    {% endif %}
    {% if selected_doctor %}
    <p>Doctor => <strong>{{ selected_doctor.first_name }} {{ selected_doctor.last_name }}</strong>
    </p> 
    {% endif %}
    {% if selected_daily_slot_status %} 
    <p>Daily Slot Status => <strong>{{ selected_daily_slot_status }}</strong></p>

    {% endif %}
     -->
  </div>
  <!-- <form action="">
    <input type="text" name="search-daily-slots" class="form-control" placeholder="Search by slot time or slot status or by doctor">
    <input type="submit" value="Search" class="btn btn-primary px-4 mt-2">
  </form> -->
  
  <!-- <a href="{% url 'doctor:add-time-slot' %}" class="btn btn-primary">
    <i class='bx bx-plus'></i>
    Add Time Slot
    </a> -->
</div>
<h5>Created Schedule</h5>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Date</th>
        
      <th scope="col">Slot</th>
      <th scope="col">Doctor</th>
      <th scope="col">Status</th>
      <th scope="col">Deleted</th>
        <th scope="col"></th>
      
      <!-- <th scope="col"></th>
      <th scope="col"></th> -->
    </tr>
  </thead>
  <tbody>
    {% for daily_slot in generated_daily_schedule %}
    <tr>
      <th scope="row">{{ forloop.counter }}</th>
        <td>{{ daily_slot.date }}</td>
      <td> {{ daily_slot.doctor_time_slot.time_slot.start_time|time:"h:i A" }}  -  {{ daily_slot.doctor_time_slot.time_slot.end_time|time:"h:i A" }} </td>
      <td> <img style="object-fit: cover;" class="rounded-circle" src="{{ daily_slot.doctor_time_slot.doctor.doctor.profile_image.url }}" alt="" width="40" height="40"> {{ daily_slot.doctor_time_slot.doctor.doctor.first_name }} {{ daily_slot.doctor_time_slot.doctor.doctor.last_name }} </td>
        <td> 
            {% if daily_slot.status == 'BOOKED' %}
            <span class="daily-booking-slot-booked">{{ daily_slot.status }}</span>
            {% elif daily_slot.status == 'AVAILABLE' %}
            <span class="daily-booking-slot-available text-white">{{ daily_slot.status }}</span>
            {% elif daily_slot.status == 'NOT-AVAILABLE' %}
            <span class="daily-booking-slot-not-available text-dark">{{ daily_slot.status }}</span>
            {% endif %}
        </td>
        <td> 
            {% if daily_slot.deleted %}
                <span class="text-danger">Deleted</span>
            {% else %}
                <span class="text-success">Active</span>
            {% endif %}
        </td>
        <td> <a href="{% url 'receptionist:daily-slots-schedule-details' daily_slot.pk %}" class="btn btn-primary">
            Change Status
          </a> </td>
      <!-- <td> <img style="object-fit: cover;" class="rounded-circle" src="{{ time_slot.doctor.doctor.profile_image.url }}" alt="" width="50" height="50"> 
        {{ time_slot.doctor.doctor.first_name }} {{ time_slot.doctor.doctor.last_name }}</td> -->
      
      <!-- <td>
        <a href="" class="btn btn-primary">
          <i class='bx bx-edit-alt'></i>
        </a>
        
      </td>
      <td>
        <a href="" class="btn btn-outline-danger">
          <i class='bx bx-trash'></i>
        </a>
      </td> -->
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if generated_daily_schedule.has_other_pages %} 
    <ul class="pagination">
      {% if generated_daily_schedule.has_previous %}
        <li><a href="?page={{ generated_daily_schedule.previous_page_number }}">&laquo;</a></li>
      {% else %}
        <li class="disabled"><span>&laquo;</span></li>
      {% endif %}
      <!-- {% for i in daily_slots_bookings.paginator.page_range %}
        {% if daily_slots_bookings.number == i %}
          <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
        {% else %}
          <li><a href="?page={{ i }}">{{ i }}</a></li>
        {% endif %}
      {% endfor %} -->
      {% for page_number in page_obj.adjusted_elided_pages %}
      
        {% if page_number == page_obj.paginator.ELLIPSIS %}
            {{page_number}}
        {% else %}
            <li class="{% if page_number == page_obj.number %}active {% endif %}">
                <a
                href="?page={{ page_number }}"
                class="{% if page_number == page_obj.number %}text-white{% endif %}"
            >
                {{page_number}}
            </a>
            </li>
        {% endif %}
    {% endfor %}
      {% if generated_daily_schedule.has_next %}
        <li><a href="?page={{ generated_daily_schedule.next_page_number }}">&raquo;</a></li>
      {% else %}
        <li class="disabled"><span>&raquo;</span></li>
      {% endif %}
    </ul>
 {% endif %}
<!-- <nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    {% if doctor_time_slots.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ doctor_time_slots.previous_page_number }}">Previous</a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
      </li>
    {% endif %}
    {% for i in doctor_time_slots.paginator.page_range %}
      {% if doctor_time_slots.number == i %}
        <li class="page-item active" aria-current="page">
          <span class="page-link">
            {{ i }}
            <span class="sr-only">(current)</span>
          </span>
        </li>
      {% else %}
        <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}
    {% if doctor_time_slots.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ doctor_time_slots.next_page_number }}">Next</a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
      </li>
    {% endif %}
  </ul>
</nav> -->
{% endif %}
</div>
  {% endblock %}
  
  {% block script %}
  
  {% endblock %}